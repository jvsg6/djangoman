{% extends 'adm/admIndex.html' %}
{% load widget_tweaks %}
{% load static %}
{% block content %}
{% load i18n %}
<script>
function addReadonlyToAll() {
    var checkBox = document.getElementById("editModeCheckBox");
    if (checkBox.checked == true)
    {
      console.log("True");
      document.getElementById('id_name').setAttribute('readonly', true); 
      document.getElementById('id_comment').setAttribute('readonly', true); 
      document.getElementById('id_meteoPhaseStart').setAttribute('readonly', true);
      document.getElementById('id_windConst').setAttribute('readonly', true);
      document.getElementById('id_precipitationsRate').setAttribute('readonly', true);
      document.getElementById('id_precipitationType').setAttribute('readonly', true);
      document.getElementById('id_stab').setAttribute('readonly', true);
      document.getElementById('id_roughness').setAttribute('readonly', true);
      document.getElementById('id_lon').setAttribute('readonly', true);
      document.getElementById('id_lat').setAttribute('readonly', true);
      document.getElementById('id_lonMinCalc').setAttribute('readonly', true);
      document.getElementById('id_lonMaxCalc').setAttribute('readonly', true);
      document.getElementById('id_latMinCalc').setAttribute('readonly', true);
      document.getElementById('id_latMaxCalc').setAttribute('readonly', true);
      document.getElementById('id_lonMinRes').setAttribute('readonly', true);
      document.getElementById('id_lonMaxRes').setAttribute('readonly', true);
      document.getElementById('id_latMinRes').setAttribute('readonly', true);
      document.getElementById('id_latMaxRes').setAttribute('readonly', true);
      document.getElementById('id_countLonRes{% load i18n %}').setAttribute('readonly', true);
      document.getElementById('id_countLatRes').setAttribute('readonly', true);
    } 
    else 
    {
      console.log("False");
      document.getElementById('id_name').removeAttribute("readonly"); 
      document.getElementById('id_comment').removeAttribute("readonly"); 
      document.getElementById('id_meteoPhaseStart').removeAttribute("readonly");
      document.getElementById('id_windConst').removeAttribute("readonly");
      document.getElementById('id_precipitationsRate').removeAttribute("readonly");
      document.getElementById('id_precipitationType').removeAttribute("readonly");
      document.getElementById('id_stab').removeAttribute("readonly");
      document.getElementById('id_roughness').removeAttribute("readonly");
      document.getElementById('id_lon').removeAttribute("readonly");
      document.getElementById('id_lat').removeAttribute("readonly");
      document.getElementById('id_lonMinCalc').removeAttribute("readonly");
      document.getElementById('id_lonMaxCalc').removeAttribute("readonly");
      document.getElementById('id_latMinCalc').removeAttribute("readonly");
      document.getElementById('id_latMaxCalc').removeAttribute("readonly");
      document.getElementById('id_lonMinRes').removeAttribute("readonly");
      document.getElementById('id_lonMaxRes').removeAttribute("readonly");
      document.getElementById('id_latMinRes').removeAttribute("readonly");
      document.getElementById('id_latMaxRes').removeAttribute("readonly");
      document.getElementById('id_countLonRes').removeAttribute("readonly");
      document.getElementById('id_countLatRes').removeAttribute("readonly");
    }
}

function addWindPhase(pk)
{
   var serializedData = $("#WindOroForm").serialize();
   console.log(serializedData);
   var endpoint = $("#WindOroForm").attr("data-url");
   $.ajax({
        url: '/ru/edit/'+ pk +'/',
        data: serializedData,
        type: 'post',
    success: 
    function(response) 
    {
        $("#windOroPhaseListTable > tbody").append(
        '<tr>'+
        '<td>' + response.newWindOroPhase.meteoPhaseStart +'</td>'+
        '<td>' + response.newWindOroPhase.windConst +'</td>'+
        '<td>' + response.newWindOroPhase.precipitationsRate +'</td>'+
        '<td>' + response.newWindOroPhase.precipitationType +'</td>'+
        '<td>' + response.newWindOroPhase.stab +'</td>'+
        '<td>' + response.newWindOroPhase.roughness +'</td>'+
        '<td><button type="button" class="btn btn-danger"><i class="fa fa-trash mr-2"></button></td>'+
        '</tr>'
        )
    }
   })
}


</script>



<div class="row">
  <div class="col-5">
    <div class="card bg-white pages-shadow-history m-p-for-cards">
    <form id="WindOroForm" data-url="{% url 'calc_edit' pk=pk %}" method="POST" class="post-form" name="WindOroForm">{% csrf_token %}</form>
    <form id="FullCalcForm" method="POST" class="post-form" name="allCalcName">{% csrf_token %}
    <nav>
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">{% trans "Common" %}</a>
        <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">{% trans "Meteo" %}</a>
        <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">{% trans "Source" %}</a>
        <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact2" role="tab" aria-controls="nav-contact2" aria-selected="false">{% trans "Area" %}</a>
        <a class="nav-item nav-link"  aria-selected="false">{% trans "Edit mode:" %}<input type="checkbox" data-size="sm" id="editModeCheckBox" onclick="addReadonlyToAll()"></a>
      </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
      <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
            {% include 'adm/createCalc/admCommon.html'%}
      </div>
      <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
            {% include 'adm/createCalc/admMeteo.html' with meteoWindOroOldList=meteoWindOroOldList meteoWindOroNew=meteoWindOroNew%}
      </div>
      <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">
            {% include 'adm/createCalc/admSource.html'%}
      </div>
      <div class="tab-pane fade" id="nav-contact2" role="tabpanel" aria-labelledby="nav-contact2-tab">
            {% include 'adm/createCalc/admArea.html'%}
      </div>
    </div>
      <button type="submit" class="btn btn-primary" name="save_calc">{% trans "Save scenario" %}</button>
      <button type="submit" class="btn btn-success" name="start_calc">{% trans "Start calculation" %}</button>
    </form>
    </div>
  </div>
  <div class="col-7">
    <div class="card bg-white pages-shadow-history m-p-for-cards">
    <div id="mapid" style="width: 100%; height: 800px;"></div>
    </div>
  </div>
</div>

<script>

  var lon = document.getElementById('id_lon').value;
  var lat = document.getElementById('id_lat').value;
  var srclatlng = L.latLng(lat, lon);
  var mymap = L.map('mapid').setView(srclatlng, 3);

  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
    maxZoom: 18,
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
      '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1
  }).addTo(mymap);
  
  var srcPos = L.marker(srclatlng, {draggable: true}).addTo(mymap)
  

  srcPos.on("drag", function(e) {
      var marker = e.target;
      var position = marker.getLatLng();
      console.log(position.lat, position.lng);
      document.getElementById('id_lon').value = position.lng
      document.getElementById('id_lat').value = position.lat;
  });

  function installSrcPosition()
  {
    var lon = document.getElementById('id_lon').value;
    var lat = document.getElementById('id_lat').value;
    var srclatlng = L.latLng(lat, lon);
    console.log(lon);
    console.log(lat);
    srcPos.setLatLng(srclatlng)
    mymap.panTo(srclatlng)
  }


</script>


{% endblock %}
